parameters:
  debug: true
  verbose: true
  run_all: true
  overwrite: false
  raw_db: "my_raw_database"
  raw_table_state: "extraction_state_table"
  raw_table_key: "extracted_keys_table"

data:
  field_selection_strategy: "merge_all"

  source_views:
    - view_external_id: "CogniteEquipment"
      view_space: "sp_enterprise_process_industry"
      view_version: "v1"
      instance_space: "sp_my_instance_space"
      entity_type: "asset"
      batch_size: 100
      include_properties:
        - "name"
        - "description"
        - "equipmentType"
        - "manufacturer"
        - "serialNumber"
      filters:
        - operator: "EQUALS"
          target_property: "equipmentType"
          values: "Pump"
          negate: false

    - view_external_id: "CogniteTimeSeries"
      view_space: "sp_enterprise_process_industry"
      view_version: "v1"
      instance_space: "sp_my_instance_space"
      entity_type: "timeseries"
      batch_size: 50
      include_properties:
        - "name"
        - "description"
        - "unit"
      filters:
        - operator: "IN"
          target_property: "type"
          values: ["temperature", "pressure", "flow"]
          negate: false

    - view_external_id: "CogniteFile"
      view_space: "sp_enterprise_process_industry"
      view_version: "v1"
      instance_space: "sp_my_instance_space"
      entity_type: "file"
      batch_size: 75
      include_properties:
        - "name"
        - "mimeType"
      filters:
        - operator: "EXISTS"
          target_property: "uploaded"
          negate: false

    - view_external_id: "CogniteAsset"
      view_space: "sp_enterprise_process_industry"
      view_version: "v1"
      instance_space: "sp_my_instance_space"
      entity_type: "asset"
      batch_size: 100
      include_properties:
        - "name"
        - "labels"
      filters:
        - operator: "CONTAINSALL"
          target_property: "labels"
          values: ["critical", "production"]
          negate: true

    - view_external_id: "CogniteDocument"
      view_space: "sp_enterprise_process_industry"
      view_version: "v1"
      instance_space: "sp_my_instance_space"
      entity_type: "file"
      batch_size: 25
      include_properties:
        - "name"
        - "content"
      filters:
        - operator: "SEARCH"
          target_property: "content"
          values: "P&ID diagram"
          negate: false

  extraction_rules:
    # JSON representation:
    # [
    #   {
    #     "rule_id": "tag_heuristic_comprehensive",
    #     "method": "heuristic",
    #     "priority": 45,
    #     "source_fields": [
    #       {"field_name": "name", "field_type": "string", "required": true, "priority": 1, "role": "target", "max_length": 500, "preprocessing": ["trim"]},
    #       {"field_name": "description", "field_type": "string", "required": false, "priority": 2, "role": "context", "max_length": 1000, "preprocessing": ["trim", "lowercase"]},
    #       {"field_name": "equipmentType", "field_type": "string", "required": false, "priority": 3, "role": "context", "max_length": 100, "preprocessing": ["trim"]}
    #     ],
    #     "config": {
    #       "name": "TAG_HEURISTIC_COMPREHENSIVE",
    #       "current_node_id": {"space": "sp_my_instance_space", "external_id": "comprehensive_node_789"},
    #       "heuristic_strategies": [
    #         {
    #           "strategy_id": "position_analysis",
    #           "weight": 0.25,
    #           "method": "positional_detection",
    #           "rules": [
    #             {"method": "positional_detection", "position": "start_of_field", "pattern": "[A-Z]{1,3}[-_]?\\d{2,6}[A-Z]?", "confidence_boost": 0.25},
    #             {"method": "positional_detection", "position": "after_keyword", "pattern": "[A-Z0-9-_]{3,20}", "confidence_boost": 0.15}
    #           ]
    #         },
    #         {
    #           "strategy_id": "corpus_frequency",
    #           "weight": 0.25,
    #           "method": "frequency_analysis",
    #           "rules": [{"analyze_corpus": true, "min_frequency": 3, "pattern_stability_threshold": 0.7, "common_prefix_detection": true, "common_suffix_detection": true}]
    #         },
    #         {
    #           "strategy_id": "contextual_clues",
    #           "weight": 0.25,
    #           "method": "context_inference",
    #           "rules": [
    #             {
    #               "surrounding_keywords": {
    #                 "positive": ["tag", "equipment", "instrument", "id", "identifier", "code"],
    #                 "negative": ["description", "note", "comment", "remark"]
    #               },
    #               "context_window": 15,
    #               "keyword_proximity_bonus": 0.12,
    #               "equipment_type_correlation": {
    #                 "enabled": true,
    #                 "type_indicators": {
    #                   "pump": ["centrifugal", "positive displacement", "submersible", "reciprocating"],
    #                   "valve": ["ball", "gate", "globe", "butterfly", "check"],
    #                   "tank": ["storage", "pressure", "atmospheric", "holding"],
    #                   "heat_exchanger": ["shell and tube", "plate", "air cooled"]
    #                 }
    #               }
    #             }
    #           ]
    #         },
    #         {
    #           "strategy_id": "similarity_matching",
    #           "weight": 0.25,
    #           "method": "example_based_learning",
    #           "rules": [
    #             {
    #               "learning_mode": "similarity",
    #               "source_db": "master_tag_database",
    #               "source_tbl": "validated_equipment_tags",
    #               "similarity_threshold": 0.82,
    #               "feature_extraction": {
    #                 "use_character_ngrams": true,
    #                 "ngram_sizes": [2, 3, 4, 5],
    #                 "use_token_patterns": true,
    #                 "use_position_features": true,
    #                 "use_length_features": true
    #               }
    #             }
    #           ]
    #         }
    #       ],
    #       "scoring": {"aggregation_method": "weighted_average", "min_confidence": 0.65, "normalize_scores": true},
    #       "confidence_modifiers": [
    #         {"condition": "multiple_strategies_agree", "operator": ">=3", "modifier": "+0.25"},
    #         {"condition": "multiple_strategies_agree", "operator": ">=2", "modifier": "+0.15"},
    #         {"condition": "field_name_indicates_tag", "field_names": ["tagId", "equipmentTag", "instrumentTag", "assetTag", "equipmentId"], "modifier": "+0.1"},
    #         {"condition": "extracted_value_length", "range": [4, 18], "modifier": "+0.08"},
    #         {"condition": "extracted_value_in_known_catalog", "catalog_source": "validated_tags", "modifier": "+0.2"}
    #       ],
    #       "validation": [
    #         {"type": "length_check", "min_length": 3, "max_length": 25},
    #         {"type": "pattern_match", "pattern": "^[A-Z0-9-_/]+$"},
    #         {"type": "blacklist_check", "blacklist": ["NULL", "N/A", "UNKNOWN", "TBD", "NONE", "TEST"]},
    #         {"type": "similarity_check", "min_similarity_to_examples": 0.65}
    #       ]
    #     }
    #   }
    # ]

    - rule_id: "tag_heuristic_comprehensive"
      method: "heuristic"
      priority: 45
      source_fields:
        - field_name: "name"
          field_type: "string"
          required: true
          priority: 1
          role: "target"
          max_length: 500
          preprocessing:
            - "trim"
        - field_name: "description"
          field_type: "string"
          required: false
          priority: 2
          role: "context"
          max_length: 1000
          preprocessing:
            - "trim"
            - "lowercase"
        - field_name: "equipmentType"
          field_type: "string"
          required: false
          priority: 3
          role: "context"
          max_length: 100
          preprocessing:
            - "trim"
      config:
        name: "TAG_HEURISTIC_COMPREHENSIVE"
        current_node_id:
          space: "sp_my_instance_space"
          external_id: "comprehensive_node_789"
        heuristic_strategies:
          - strategy_id: "position_analysis"
            weight: 0.25
            method: "positional_detection"
            rules:
              - method: "positional_detection"
                position: "start_of_field"
                pattern: "[A-Z]{1,3}[-_]?\\d{2,6}[A-Z]?"
                confidence_boost: 0.25
              - method: "positional_detection"
                position: "after_keyword"
                pattern: "[A-Z0-9-_]{3,20}"
                confidence_boost: 0.15
          - strategy_id: "corpus_frequency"
            weight: 0.25
            method: "frequency_analysis"
            rules:
              - analyze_corpus: true
                min_frequency: 3
                pattern_stability_threshold: 0.7
                common_prefix_detection: true
                common_suffix_detection: true
          - strategy_id: "contextual_clues"
            weight: 0.25
            method: "context_inference"
            rules:
              - surrounding_keywords:
                  positive:
                    - "tag"
                    - "equipment"
                    - "instrument"
                    - "id"
                    - "identifier"
                    - "code"
                  negative:
                    - "description"
                    - "note"
                    - "comment"
                    - "remark"
                context_window: 15
                keyword_proximity_bonus: 0.12
                equipment_type_correlation:
                  enabled: true
                  type_indicators:
                    pump:
                      - "centrifugal"
                      - "positive displacement"
                      - "submersible"
                      - "reciprocating"
                    valve:
                      - "ball"
                      - "gate"
                      - "globe"
                      - "butterfly"
                      - "check"
                    tank:
                      - "storage"
                      - "pressure"
                      - "atmospheric"
                      - "holding"
                    heat_exchanger:
                      - "shell and tube"
                      - "plate"
                      - "air cooled"
          - strategy_id: "similarity_matching"
            weight: 0.25
            method: "example_based_learning"
            rules:
              - learning_mode: "similarity"
                source_db: "master_tag_database"
                source_tbl: "validated_equipment_tags"
                similarity_threshold: 0.82
                feature_extraction:
                  use_character_ngrams: true
                  ngram_sizes: [2, 3, 4, 5]
                  use_token_patterns: true
                  use_position_features: true
                  use_length_features: true
        scoring:
          aggregation_method: "weighted_average"
          min_confidence: 0.65
          normalize_scores: true
        confidence_modifiers:
          - condition: "multiple_strategies_agree"
            operator: ">=3"
            modifier: "+0.25"
          - condition: "multiple_strategies_agree"
            operator: ">=2"
            modifier: "+0.15"
          - condition: "field_name_indicates_tag"
            field_names:
              - "tagId"
              - "equipmentTag"
              - "instrumentTag"
              - "assetTag"
              - "equipmentId"
            modifier: "+0.1"
          - condition: "extracted_value_length"
            range: [4, 18]
            modifier: "+0.08"
          - condition: "extracted_value_in_known_catalog"
            catalog_source: "validated_tags"
            modifier: "+0.2"
        validation:
          - type: "length_check"
            min_length: 3
            max_length: 25
          - type: "pattern_match"
            pattern: "^[A-Z0-9-_/]+$"
          - type: "blacklist_check"
            blacklist:
              - "NULL"
              - "N/A"
              - "UNKNOWN"
              - "TBD"
              - "NONE"
              - "TEST"
          - type: "similarity_check"
            min_similarity_to_examples: 0.65
